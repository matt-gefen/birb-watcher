<%- include('../partials/html-head') %>
<link 
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" 
  rel="stylesheet" 
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" 
  crossorigin="anonymous"
>
<%- include('../partials/nav') %>

<main>
  <% if (isSelf) { %>
    <h1>Your Sightings</h1>
  <% } else { %>
  <h1><%= profile.name%>'s Sightings</h1>
  <% } %> 
  <% if (isSelf) { %>
    <h2>Add Sighting</h2>
    <form action="/profiles/<%=profile._id%>" method='POST'>
      <label>
        Date:
        <input type="date" name='date'>
      </label><br>
      <label>
        City:
        <input type="text" name='city'>
      </label><br>
      <label>
        State:
        <select name="state">
          <% states.forEach((state) => { %> 
            <option value="<%=state%>"><%=state%></option>
          <% }) %> 
        </select>
      </label><br>
      <label>
        Notes: <br>
        <textarea name="notes">Anything Notable?</textarea>
      </label><br>
      <label>
        Bird:
        <select>
          <% usSpecies.forEach((species) => { %> 
            <option value="<%=species.speciesCode%>"><%=species.comName%></option>
          <% }) %> 
        </select>
      </label><br>
      <button>Add Sightings</button>
    </form>
  <% } %>

<h2>Sightings</h2>
<% profile.sightings.sort((a,b) => {return b.date - a.date}) %>
<% profile.sightings.forEach(sighting => { %>
  <div class="card text-center">
    <div id='sighting-header' class="card-header">
      Sighting
      <form action='/profiles/<%=profile._id%>/<%=sighting._id%>?_method=DELETE' method='post'>
        <button type="submit">X</button>
      </form>
    </div>
    <div class="card-body">
      <h5 class="card-title"><%= sighting.city %>, <%= sighting.state %> </h5>
      <p class="card-text">Birds go here</p>
      <a href="/profiles/<%=profile._id%>/<%=sighting._id%>" class="btn btn-primary">Details</a>
    </div>
    <div class="card-footer text-muted">
      <%= sighting.date.toLocaleDateString() %>
    </div>
  </div>
<% }) %> 
</main>

<%- include('../partials/footer') %>